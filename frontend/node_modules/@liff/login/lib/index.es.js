import{__extends as i,__spreadArray as o,__read as r}from"tslib";import{INVALID_CONFIG as e}from"@liff/consts";import{logger as t}from"@liff/logger";import{hexToBase64 as f,randomAlphaNumericString as n,createLiffError as l,qs as p}from"@liff/util";import{getConfig as c,setLoginTmp as m}from"@liff/store";import{getEndPoint as s}from"@liff/server-api";import{LiffModule as d}from"@liff/use";import{getVersion as a}from"@liff/get-version";import{isSubWindow as u}from"@liff/is-sub-window";import{isInClient as g}from"@liff/is-in-client";import h from"tiny-sha256";import{SyncHook as _}from"@liff/hooks";import{getMessageBus as b}from"@liff/sub-window";var v=function(i){var o,r=n(43),d=f(h(r)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),_=c();if(!_||!_.liffId)throw l(e,"You need to define `liffId` for liff.login()");var v={app_id:_.liffId,state:n(12),response_type:"code",code_challenge_method:"S256",code_challenge:d,liff_sdk_version:a()};i&&i.redirectUri&&(v.redirect_uri=i.redirectUri),u()&&!g()&&((null===(o=b())||void 0===o?void 0:o.isReady())?v.redirect_uri=window.location.href:v.disable_auto_login="true"),m({codeVerifier:r});var w=s("authorize")+"?"+p.stringify(v);t.debug("[Redirect] ".concat(w)),window.location.href=w},w=function(e){function t(){var i=e.apply(this,o([],r(arguments),!1))||this;return i.hooks={before:new _},i}return i(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"login"},enumerable:!1,configurable:!0}),t.prototype.install=function(){return this._login.bind(this)},t.prototype._login=function(i){this.hooks.before.call(i),v(i)},t}(d);export{w as LoginModule,v as login};
