import{__assign as e,__awaiter as t,__generator as n,__read as r,__values as o,__extends as i,__spreadArray as a}from"tslib";import{LiffModule as c}from"@liff/use";import{done as s}from"@liff/ready";import{isLoggedIn as l}from"@liff/is-logged-in";import{convertHexToRgb as f,convertArgbToRgba as u,createLiffError as d,base64Url as h,convertArrayBuffer as p,compareVersion as v,qs as m,extractChannelIdFromLiffId as w,addParamsToUrl as g,randomAlphaNumericString as b,replaceUrlCredentialRemoved as k}from"@liff/util";import{getContext as C,getLoginTmp as F,getExpireTime as y,getIsSubsequentLiffApp as I,getFeatureToken as _,setIsSubsequentLiffApp as B,getMST as x,getAccessToken as S,getRawContext as T,getIDToken as A,getClientId as E,getMSTChallenge as L,getMSTVerifier as N,getMSIT as D,getConfig as O,setDecodedIDToken as U,setAppData as P,setMST as W,setFeatureToken as j,setExpireTime as M,setAccessToken as R,setContext as H,setMSTChallenge as K,setMSTVerifier as V,setClientId as J,setMSIT as q,setIDToken as z,getDecodedIDToken as G,removeLoginTmp as Q,setConfig as X}from"@liff/store";import{CheckAvailability as Y}from"@liff/check-availability";import{FORBIDDEN as Z,INIT_FAILED as $,INVALID_ID_TOKEN as ee,SUB_WINDOW_STATUS as te,SUB_WINDOW_HEALTH_CHECK_MESSAGE as ne,INVALID_CONFIG as re}from"@liff/consts";import{load as oe}from"@liff/extensions";import{isInClient as ie}from"@liff/is-in-client";import{logout as ae}from"@liff/logout";import{isSubWindow as ce}from"@liff/is-sub-window";import{validatePermalinkGeneratability as se}from"@liff/permanent-link";import{getMSTByMSIT as le,getAppData as fe,getMainWindowOrigin as ue,getMessageBus as de,initMessageBus as he,setMainWindowOrigin as pe}from"@liff/sub-window";import{fetch as ve,getEndPoint as me,verifyAccessToken as we}from"@liff/server-api";import{logger as ge}from"@liff/logger";import{getLineVersion as be}from"@liff/get-line-version";import{addListener as ke,removeListener as Ce}from"@liff/native-bridge";import{isApiAvailable as Fe}from"@liff/is-api-available";import{getOS as ye}from"@liff/get-os";import{login as Ie}from"@liff/login";import{closeWindow as _e}from"@liff/close-window";import{EVENT_NAME as Be,WINDOW as xe,IDENTIFIER_KEY as Se}from"@liff/message-bus";import{AsyncHook as Te}from"@liff/hooks";import{t as Ae}from"@liff/i18n";var Ee={iconColor:"#111111",statusBarColor:"BLACK",titleTextColor:"#111111",titleSubtextColor:"#B7B7B7",titleButtonColor:"#111111",titleBackgroundColor:"#FFFFFF",progressBarColor:"#06C755",progressBackgroundColor:"#FFFFFF",titleButtonAreaBackgroundColor:"#1FFFFFFF",titleButtonAreaBorderColor:"#26000000",baseBackgroundColor:"#FFFFFF",baseTextColor:"#000000",lightButtonBorderColor:"rgba(0, 0, 0, 0.15)"},Le={iconColor:"#FFFFFF",statusBarColor:"WHITE",titleTextColor:"#FFFFFF",titleSubtextColor:"#949494",titleButtonColor:"#FFFFFF",titleBackgroundColor:"#111111",progressBarColor:"#06C755",progressBackgroundColor:"#111111",titleButtonAreaBackgroundColor:"#1FFFFFFF",titleButtonAreaBorderColor:"#26000000",baseBackgroundColor:"#000000",baseTextColor:"#FFFFFF",lightButtonBorderColor:"rgba(255, 255, 255, 0.5)"};function Ne(){var e;Ue("color-scheme",((null==(e=C())?void 0:e.menuColorSetting)||{adaptableColorSchemes:["light"]}).adaptableColorSchemes.join(" "));var t=window.matchMedia("(prefers-color-scheme: dark)");De({matches:null==t?void 0:t.matches,media:null==t?void 0:t.media}),t.addEventListener?t.addEventListener("change",De):t.addListener&&t.addListener(De)}function De(t){var n=C(),r=(null==n?void 0:n.menuColorSetting)||{adaptableColorSchemes:["light"],lightModeColor:Ee,darkModeColor:Le},o=r.adaptableColorSchemes,i=r.lightModeColor,a=r.darkModeColor,c=o.includes("dark");t.matches&&c?Oe(e(e({},Le),a)):Oe(e(e({},Ee),i))}function Oe(e){var t=e.iconColor,n=e.statusBarColor,r=e.titleTextColor,o=e.titleSubtextColor,i=e.titleButtonColor,a=e.titleBackgroundColor,c=e.progressBarColor,s=e.progressBackgroundColor,l=e.titleButtonAreaBackgroundColor,d=e.titleButtonAreaBorderColor,h=e.baseBackgroundColor,p=e.baseTextColor,v=e.lightButtonBorderColor;Ue("--liff-base-background-color",h),Ue("--liff-base-text-color",p),Ue("--liff-base-background-rgb-color",f(h)),Ue("--liff-base-text-rgb-color",f(p)),Ue("--liff-light-button-border-color",v),Ue("--liff-title-text-color",r),Ue("--liff-title-background-color",a),Ue("--liff-title-button-color",i),Ue("--liff-icon-color",t),Ue("--liff-status-bar-color",n),Ue("--liff-title-subtext-color",o),Ue("--liff-progress-bar-color",c),Ue("--liff-progress-background-color",s),Ue("--liff-title-button-area-background-color",u(l)),Ue("--liff-title-button-area-border-color",u(d))}function Ue(e,t){document.documentElement.style.setProperty(e,t)}var Pe={addToHomeScreen:function(e){if(!new Y(e).invoke("addToHomeScreen"))throw d(Z,"No permission for liff.addToHomeScreen()")},scanCode:function(e){if(!new Y(e).invoke("scanCode"))return Promise.reject(d(Z,"No permission for liff.scanCode()"))},getAdvertisingId:function(e){if(!new Y(e).invoke("getAdvertisingId"))return Promise.reject(d(Z,"No permission for liff.getAdvertisingId()"))},initPlugins:function(){}};function We(e){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,oe()];case 1:return(t=n.sent())?(t.install(e,Pe),[2]):[2]}}))}))}function je(){return t(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,ve(me("certs"))];case 1:return[2,e.sent()]}}))}))}function Me(e,r,o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])];case 1:return t=n.sent(),[4,crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},t,o,r)];case 2:return[2,n.sent()]}}))}))}function Re(e,o){return t(this,void 0,void 0,(function(){var t,i,a,c,s,l,f,u,v,m,w,g,b,k,C,F;return n(this,(function(n){switch(n.label){case 0:return t=e.split("."),i=r(t,3),a=i[0],c=i[1],s=i[2],l=JSON.parse(h.decode(a)),f=JSON.parse(h.decodeUnicode(c)),u=p(h.decode(s)),v=p("".concat(a,".").concat(c)),[4,je()];case 1:if(m=n.sent(),!(w=m.keys.find((function(e){return e.kid===l.kid}))))return[3,6];if(delete w.alg,"ES256"!==l.alg)throw d(ee,'Invalid "alg" value in ID_TOKEN');g=void 0,n.label=2;case 2:return n.trys.push([2,4,,5]),[4,Me(w,v,u)];case 3:return g=n.sent(),[3,5];case 4:throw b=n.sent(),d(ee,"".concat("Failed to use Crypto API to verify ID_TOKEN",": ").concat(b));case 5:if(g){if(k=f.iss!=="https://access.".concat("line.me"),C=f.aud!==o,F=1e3*f.exp<Date.now(),k)throw d(ee,'Invalid "iss" value in ID_TOKEN');if(C)throw d(ee,'Invalid "aud" value in ID_TOKEN');if(F)throw d(ee,'Invalid "exp" value in ID_TOKEN');return[2,f]}throw d(ee,"Invalid signature in ID_TOKEN");case 6:throw d(ee,'Invalid "kid" value in ID_TOKEN');case 7:return[2]}}))}))}function He(e){var t=e.split(".");if(t[1])try{var n=t[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(window.atob(n))}catch(r){return null}return null}function Ke(e){var t=e.pathname,n=e.query,r=n?"?".concat(m.stringify(n)):"",o="".concat("liff://").concat(t).concat(r);location.href=o}var Ve=null;function Je(){"boolean"==typeof Ve&&ge.warn("liff.init is not expected to be called more than once"),Ve=!!I()||!(!ie()||m.parse(window.location.hash).feature_token||_())&&(B(!0),!0)}function qe(){return Boolean(Ve)}function ze(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return(t=x())?[2,t]:e&&r?[4,le({msit:e,mstVerifier:r})]:[3,2];case 1:return[2,n.sent().mst];case 2:return[2,null]}}))}))}function Ge(e){return ve("".concat(me("apps"),"/").concat(e,"/featureToken"))}function Qe(e){return t(this,void 0,void 0,(function(){var t,r,i,a;return n(this,(function(n){switch(n.label){case 0:return t=m.parse(window.location.hash),r=function(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a=function(t){Object.keys(t).filter((function(e){return null!==t[e]&&void 0!==t[e]})).forEach((function(n){e[n]=t[n]}))};try{for(var c=o(r),s=c.next();!s.done;s=c.next()){a(s.value)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return e}({access_token:S(),context_token:T(),feature_token:_(),id_token:A(),client_id:E(),mst_challenge:L(),mst_verifier:N(),msit:D()},t),qe()?l()?[4,Ge(e)]:[3,2]:[3,3];case 1:i=n.sent().featureToken,r.feature_token||(r.feature_token=i),n.label=2;case 2:(a=w(e))&&(r.client_id=a),n.label=3;case 3:return[2,r]}}))}))}function Xe(e){if(e.persisted&&Fe("multipleLiffTransition"))if("ios"===ye())window.location.reload();else{var t=O().liffId,n=_();if(!t)throw d($,"Invalid LIFF ID.");if(!n)throw d(Z,"Invalid featureToken for client features");Ke({pathname:"app/".concat(t),query:{feature_token:n}})}}function Ye(e){return t(this,void 0,void 0,(function(){var t,r,o,i,a,c,s,f,u,h,p,m,b,k,F,y,I,_,B;return n(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(e){var t=be();if(!t||v(t,"9.5.0")<0)e();else if(window._liff&&window._liff.features)e();else{ge.debug("cannot find window._liff.features, listen to ready event");var n=function(){ge.debug("ready event is fired"),Ce("ready",n),e()};ke("ready",n)}}))];case 1:return n.sent(),Je(),[4,Qe(e.liffId)];case 2:if(t=n.sent(),r=t.access_token,o=t.context_token,i=t.feature_token,a=t.id_token,c=t.client_id,s=t.mst_verifier,f=t.mst_challenge,u=t.msit,o){if("string"!=typeof o)throw d($,"Cannot get context token, perhaps there is an incorrect parameter in permanent link");H(He(o))}if(void 0!==(null===(_=C())||void 0===_?void 0:_.liffId)&&(null===(B=C())||void 0===B?void 0:B.liffId)!==e.liffId)throw d($,"Invalid LIFF ID");return!ce()&&i&&(!function(e,t){Fe("multipleLiffTransition")&&Ke({pathname:"app/".concat(e),query:{feature_token:t}})}(e.liffId,i),qe()&&j(i)),f&&K(f),s&&V(s),c&&J(c),u&&q(u),window.addEventListener("pageshow",Xe),l()?[3,5]:i&&r?[3,5]:qe()?(h=g(location.href,{"liff.hback":"2"}),Ie({redirectUri:h}),[4,new Promise((function(){}))]):[3,4];case 3:n.sent(),n.label=4;case 4:throw Ie(),d($,"Failed to parse feature_token or access_token");case 5:return r&&i?[4,we(r)]:[3,7];case 6:if(p=n.sent(),m=p.client_id,b=p.expires_in,k=w(e.liffId),m!==k)throw Ie(),d($,"Failed to verify access_token");j(i),M(new Date(Date.now()+1e3*b)),R(r),n.label=7;case 7:return[4,ze(u,s)];case 8:return(F=n.sent())?(W(F),[4,fe({mst:F})]):[3,10];case 9:(y=n.sent().data)&&P(JSON.stringify(y)),n.label=10;case 10:return a&&!A()&&z(a),a&&c&&!G()?[4,Re(a,c)]:[3,12];case 11:(I=n.sent())&&U(I),n.label=12;case 12:return[2]}}))}))}function Ze(e){return t(this,void 0,void 0,(function(){var t,r,o,i,a,c,s;return n(this,(function(n){switch(n.label){case 0:return t=me("apps"),r="".concat(t,"/").concat(e,"/contextToken"),o=S(),i={"Content-Type":"application/json",Accept:"application/json"},o&&(i.Authorization="Bearer ".concat(o)),[4,ve(r,{headers:i})];case 1:if(a=n.sent(),!(c=a.contextToken))throw d($,"Can not get context from server.");if(!(s=He(c)))throw d($,"Invalid context token.");return[2,s]}}))}))}function $e(){return t(this,void 0,void 0,(function(){var e,t;return n(this,(function(n){switch(n.label){case 0:if(!(e=O().liffId))throw d($,"Invalid LIFF ID.");return[4,Ze(e)];case 1:return t=n.sent(),H(t),[2]}}))}))}function et(e){return t(this,void 0,void 0,(function(){var r,o,i,a=this;return n(this,(function(c){switch(c.label){case 0:r=function(){return t(a,void 0,void 0,(function(){var t,r,o,i,a,c;return n(this,(function(n){switch(n.label){case 0:return[4,(s=O(),l=m.parse(window.location.search),f=F(),u={grant_type:"authorization_code",client_id:l.liffClientId,appId:s.liffId,code:l.code,code_verifier:f.codeVerifier,redirect_uri:s.redirectUri||l.liffRedirectUri,id_token_key_type:"JWK"},d=m.stringify(u),ve(me("token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:d}))];case 1:return t=n.sent(),r=t.access_token,o=t.id_token,i=t.expires_in,J(e),R(r),M(new Date(Date.now()+1e3*i)),Q(),o?(z(o),[4,Re(o,e)]):[3,3];case 2:(a=n.sent())&&U(a),n.label=3;case 3:return(c=m.parse(location.hash).context_token)?(H(He(c)),[3,6]):[3,4];case 4:return[4,$e()];case 5:n.sent(),n.label=6;case 6:return[2]}var s,l,f,u,d}))}))},c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r()];case 2:return c.sent(),[3,4];case 3:throw o=c.sent(),i=o,Q(),i;case 4:return[2]}}))}))}function tt(){return t(this,void 0,void 0,(function(){var e,r,o,i,a,c,s=this;return n(this,(function(f){switch(f.label){case 0:return(r=de())?[3,2]:[4,he(xe.SUB)];case 1:r=f.sent(),f.label=2;case 2:return(e=r).isReady()?(o=b(8),[4,e.getData("appData")]):[3,8];case 3:return i=f.sent(),a=i.eventName,c=i.data,a!==Be.NOT_FOUND?[3,6]:[4,e.teardown()];case 4:return f.sent(),[4,tt()];case 5:return[2,f.sent()];case 6:c&&P(JSON.stringify(c)),f.label=7;case 7:return e.listen((function(r){return t(s,void 0,void 0,(function(){var t,i;return n(this,(function(n){return t=r.context,i=t.data,t.eventName===te.INIT&&(null==i?void 0:i.subWindowId)!==o&&_e(),t.eventName!==te.CANCEL&&t.eventName!==te.SUBMIT||e.teardown(),[2]}))}))})),l()&&e.send({eventName:te.INIT,data:{subWindowId:o,hasOpener:!!window.opener}}),[3,10];case 8:return ue()?[3,10]:[4,new Promise((function(e){window.addEventListener("message",function(e){return function t(n){var r=n.data,o=n.source,i=n.origin;if(r){var a=r.type,c=r.message;a===ne&&(window.removeEventListener("message",t),c&&P(c),pe(i),o&&o.postMessage&&o.postMessage({status:ne},i),e())}}}(e))}))];case 9:return[2,f.sent()];case 10:return[2]}}))}))}var nt=new(function(){function e(){var e=this;this.getAndValidateContext=function(){var e=C();if(!e)throw d($,"Could not get Context from server.");if(!e.endpointUrl)throw d($,"Could not get endpointUrl from server.");if(!e.permanentLinkPattern)throw d($,"Could not get permanentLinkPattern from server.");return e},this.decodeState=function(t){var n=e.getAndValidateContext();t=t.replace(/\n/g,"%0D%0A");var r=e.hasTrailingSlash(n.endpointUrl)||e.hasTrailingSlash(t),o=new URL(n.endpointUrl),i=o.origin,a=o.pathname,c=o.search,s=new URL("".concat(i).concat(e.attachSlashAtStart(t))),l=s.pathname,f=s.search,u=s.hash,d="".concat(c).concat(c?f.replace(/\?/g,"&"):f),h="".concat(a).concat(e.attachSlashAtStart(l)).replace("//","/");return(h=e.attachSlashAtStart("".concat(h))).endsWith("/")&&!r&&(h=h.substring(0,h.length-1)),"".concat(i).concat(h).concat(d).concat(u).replace(/%0D%0A/g,"\n")}}return e.prototype.attachSlashAtStart=function(e){return"".concat(e&&e.length>0&&!e.startsWith("/")?"/":"").concat(e)},e.prototype.hasTrailingSlash=function(e){var t=e.indexOf("?"),n=e.indexOf("#"),r=-1;return(r=-1===t&&-1===n?e.length:-1===t?n:-1===n?t:Math.min(t,n))>0&&"/"===e[r-1]},e.prototype.invoke=function(){return t(this,void 0,void 0,(function(){var e,t,r,o,i;return n(this,(function(n){switch(n.label){case 0:if(e=m.parse(window.location.search),"string"!=typeof(t=e["liff.state"]))return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),r=location.href,(o=this.decodeState(t))===r?[3,3]:(e["liff.hback"]?location.replace(g(o,{"liff.hback":e["liff.hback"]})):location.replace(o),[4,new Promise((function(){}))]);case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:if((i=n.sent()).code===$)throw i;return ge.debug(i),[3,5];case 5:return[2]}}))}))},e}());function rt(e,r){return t(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:if(!e.liffId)throw d(re,"liffId is necessary for liff.init()");return X(e),!ie()&&l()&&(y()||ae()),t=m.parse(window.location.search),!ce()||ie()?[3,2]:[4,tt()];case 1:n.sent(),n.label=2;case 2:if(t.error&&t.liffOAuth2Error)throw c=t.error,s=t.error_description,f=s.replace(/\+/g," "),u="".concat(c,": ").concat(f),d($,u);return i=t.code,a=F(),Boolean(i&&!l()&&a&&a.codeVerifier)?[4,et(t.liffClientId)]:[3,4];case 3:n.sent(),n.label=4;case 4:return ie()?[4,Ye(e)]:[3,6];case 5:return n.sent(),[3,8];case 6:return l()?[3,8]:[4,$e()];case 7:n.sent(),n.label=8;case 8:return[4,nt.invoke()];case 9:if(n.sent(),o=C())try{se(location.href,o.endpointUrl)}catch(h){ge.warn("liff.init() was called with a current URL that is not related to the endpoint URL.\n".concat(location.href," is not under ").concat(o.endpointUrl))}return[4,r()];case 10:return n.sent(),k(window.location.href),[2]}var i,a,c,s,f,u}))}))}var ot=function(e,t){return new Promise((function(n,r){if(e){var o=document.createElement("script");o.type="module",o.onload=function(){n()},o.src=e,document.head.appendChild(o)}else r(d(re,t))}))},it=function(e){var t="https://static.line-scdn.net/lui/edge/versions/1.13.0/lui-alert.js";return t&&e&&(t=t.replace(/\d{1,2}\.\d{1,2}\.\d{1,3}/,e)),ot(t,"LUI_ALERT_URL is not defined")},at=function(){return t(void 0,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return e=function(){var e,t=document.querySelector('script[src*="luivendor.js"]');if(t&&(null===(e=t.src.match(/\d{1,2}\.\d{1,2}\.\d{1,3}/g))||void 0===e?void 0:e.length))return t.src.match(/\d{1,2}\.\d{1,2}\.\d{1,3}/g)[0]}(),e?[3,2]:[4,ot("https://static.line-scdn.net/lui/edge/versions/1.13.0/luivendor.js","LUI_VENDOR_URL is not defined")];case 1:t.sent(),t.label=2;case 2:return[4,it(e)];case 3:return t.sent(),[4,(n=b(6),new Promise((function(){var e=document.createElement("div");e.innerHTML='<lui-alert id="'.concat("liffAlert","-").concat(n,'" shown title="').concat(Ae("alert.android.extBrowser.autoLoginWorkaround.title"),'" message="').concat(Ae("alert.android.extBrowser.autoLoginWorkaround.desc"),'" button="').concat(Ae("alert.android.extBrowser.autoLoginWorkaround.button.text"),'"></lui-alert>'),document.body.appendChild(e);var t=document.getElementById("".concat("liffAlert","-").concat(n));t&&t.addEventListener("lui-button-click",(function(){var e=window.open(g(window.location.href,{liffIsEscapedFromApp:"true"}),"_blank");e&&(e.location.href=g(window.location.href,{liffIsEscapedFromApp:"true"}),window.close())}))})))];case 4:return t.sent(),[2]}var n}))}))},ct=function(e){try{return new URL(e).searchParams.get("lineAppVersion")}catch(t){return null}};function st(){return t(this,void 0,void 0,(function(){var e,t,r;return n(this,(function(n){switch(n.label){case 0:return e=null!==(r=ct(window.location.href))&&void 0!==r?r:ct(window.document.referrer),!!e&&v(e,"13.10.0")>=0?[2]:ie()||"android"!==ye()||(t=m.parse(window.location.search))[Se]||t.liffIsEscapedFromApp?[2]:t.liffClientId&&document.referrer.includes("access.".concat("line.me"))?(window.location.href=g(window.location.href,{liffIsEscapedFromApp:"true"}),[2]):t.liffClientId&&document.referrer.includes("android-app://")?[4,at()]:[3,2];case 1:n.sent(),n.label=2;case 2:return t.liffClientId&&""===document.referrer&&1===window.history.length?[4,at()]:[3,4];case 3:n.sent(),n.label=4;case 4:return!document.referrer.includes("liffClientId")||document.referrer.includes("liffIsEscapedFromApp")?[3,6]:[4,at()];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))}var lt=function(e){function o(){var t=e.apply(this,a([],r(arguments),!1))||this;return t.hooks={before:new Te,after:new Te},t.internalHooks={beforeFinished:new Te,beforeSuccess:new Te,error:new Te},t}return i(o,e),Object.defineProperty(o.prototype,"name",{get:function(){return"init"},enumerable:!1,configurable:!0}),o.prototype.install=function(e){var t=e.liff;return this.liffForWindow=t,this.init.bind(this)},o.prototype.init=function(e,r,o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,this.hooks.before.call()];case 1:n.sent(),i=this.liffForWindow,window&&!window.liff&&(window.liff=i),n.label=2;case 2:return n.trys.push([2,9,,11]),[4,Promise.all([We(this.liffForWindow),rt(e,this.internalHooks.beforeFinished.call)])];case 3:return n.sent(),Ne(),[4,this.internalHooks.beforeSuccess.call()];case 4:return n.sent(),!e.withLoginOnExternalBrowser||l()?[3,6]:(Ie(),[4,new Promise((function(){}))]);case 5:n.sent(),n.label=6;case 6:return[4,st()];case 7:return n.sent(),[4,this.hooks.after.call()];case 8:return n.sent(),"function"==typeof r&&r(),s(),[3,11];case 9:return t=n.sent(),[4,this.internalHooks.error.call(t)];case 10:throw n.sent(),"function"==typeof o&&o(t),t;case 11:return[2]}var i}))}))},o}(c);export{lt as InitModule};
