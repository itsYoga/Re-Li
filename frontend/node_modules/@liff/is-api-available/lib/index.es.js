import{__extends as e,__spreadArray as r,__read as n}from"tslib";import{FORBIDDEN as a,UNAUTHORIZED as i,INVALID_ARGUMENT as o}from"@liff/consts";import{LiffModule as t}from"@liff/use";import{compareVersion as l,isLIFFBrowser as c,isLINEBrowser as s,createLiffError as d}from"@liff/util";import{isSubWindow as u}from"@liff/is-sub-window";import{getContext as f}from"@liff/store";import{getLineVersion as p}from"@liff/get-line-version";import{isInClient as m}from"@liff/is-in-client";import{isLoggedIn as b}from"@liff/is-logged-in";import{getOS as v}from"@liff/get-os";function g(e){var r,n=f();return null===(r=null==n?void 0:n.availability)||void 0===r?void 0:r[e]}function h(e,r,n){var i=g(e),o=n||e;if(!i)return{available:!1,error:{code:a,message:"".concat(o," is not allowed in this LIFF app")}};var t=i.minVer,c=i.unsupportedFromVer,s=!t||function(e,r){var n=p();return!!n&&!(r&&l(n,r)>0)&&l(n,e)>=0}(t,c),d=m();return d&&!s?{available:!1,error:{code:a,message:"".concat(o," is unavailable in this client version.")}}:i.permission?d&&s||r?{available:!0}:{available:!1,error:{code:a,message:"".concat(o," is not allowed in external browser")}}:{available:!1,error:{code:a,message:"".concat(o," is not allowed in this LIFF app")}}}var w=function(){return b()?!c()&&s()?{available:!1,error:{code:a,message:"Subwindow is not supported in this browser"}}:u()?{available:!1,error:{code:a,message:"this api can be only called in parent window"}}:h("subwindowOpen",!0):{available:!1,error:{code:i,message:"Need access_token for api call, Please login first"}}},S=["subwindowOpen","shareTargetPicker","multipleLiffTransition","scanCode","scanCodeV2","getAdvertisingId","addToHomeScreen","bluetoothLeFunction","skipChannelVerificationScreen","createShortcutOnHomeScreen","internalCreateShortcutOnHomeScreen","iap"],C={scanCode:function(){return h("scanCode")},getAdvertisingId:function(){return h("getAdvertisingId")},bluetoothLeFunction:function(){return h("bluetoothLeFunction")},shareTargetPicker:function(){return u()?{available:!1,error:{code:a,message:"this api can be only called in parent window"}}:b()?h("shareTargetPicker",!0):{available:!1,error:{code:i,message:"Need access_token for api call, Please login first"}}},multipleLiffTransition:function(){var e=g("multipleLiffTransition");return e&&e.permission?m()?{available:!0}:{available:!1,error:{code:a,message:"multipleLiffTransition is available only in the LINE App browser"}}:{available:!1,error:{code:a,message:"multipleLiffTransition is not allowed in this LIFF app"}}},subwindowOpen:w,scanCodeV2:function(){if(!b())return{available:!1,error:{code:i,message:"Need access_token for api call, Please login first"}};var e=w();return e.available?h("scanCodeV2",!0):e},addToHomeScreen:function(){return u()?{available:!1,error:{code:a,message:"this api can be only called in parent window"}}:h("addToHomeScreen")},skipChannelVerificationScreen:function(){var e=f();return e?"square_chat"===e.type?{available:!1,error:{code:a,message:"skipChannelVerificationScreen is not allowed in OpenChat"}}:h("skipChannelVerificationScreen"):{available:!1,error:{code:a,message:"Context is not found"}}},createShortcutOnHomeScreen:function(){if(u())return{available:!1,error:{code:a,message:"this api can be only called in parent window"}};if(!b())return{available:!1,error:{code:i,message:"Need access_token for api call, Please login first"}};var e=v();return"android"!==e&&"ios"!==e?{available:!1,error:{code:a,message:"this api can be only called in mobile device"}}:h("addToHomeV2",!0,"createShortcutOnHomeScreen")},internalCreateShortcutOnHomeScreen:function(){if(u())return{available:!1,error:{code:a,message:"this api can be only called in parent window"}};if(!b())return{available:!1,error:{code:i,message:"Need access_token for api call, Please login first"}};var e=v();if("android"!==e&&"ios"!==e)return{available:!1,error:{code:a,message:"this api can be only called in mobile device"}};var r=h("addToHomeV2",!0,"internalCreateShortcutOnHomeScreen");return r.available?h("addToHomeLineScheme",!0,"internalCreateShortcutOnHomeScreen"):r},iap:function(){return m()?b()?u()?{available:!1,error:{code:a,message:"this api can be only called in parent window"}}:h("iap",!1,"In-App Purchase"):{available:!1,error:{code:i,message:"Need access_token for api call, Please login first"}}:{available:!1,error:{code:a,message:"In-App Purchase is not allowed in external browser"}}}},T=function(e){return function(){var r=e();if(!r.available)throw d(r.error.code,r.error.message)}},H={scanCode:T(C.scanCode),getAdvertisingId:T(C.getAdvertisingId),bluetoothLeFunction:T(C.bluetoothLeFunction),shareTargetPicker:T(C.shareTargetPicker),multipleLiffTransition:T(C.multipleLiffTransition),subwindowOpen:T(C.subwindowOpen),scanCodeV2:T(C.scanCodeV2),addToHomeScreen:T(C.addToHomeScreen),skipChannelVerificationScreen:T(C.skipChannelVerificationScreen),createShortcutOnHomeScreen:T(C.createShortcutOnHomeScreen),internalCreateShortcutOnHomeScreen:T(C.internalCreateShortcutOnHomeScreen),iap:T(C.iap)};function k(e){if(!function(e){return S.some((function(r){return r===e}))}(e))throw d(o,"Unexpected API name.");var r=C[e];return!r||r().available}var O=function(a){function i(){var e=a.apply(this,r([],n(arguments),!1))||this;return e.hooks={},e}return e(i,a),Object.defineProperty(i.prototype,"name",{get:function(){return"isApiAvailable"},enumerable:!1,configurable:!0}),i.prototype.install=function(){return function(e){return k(e)}},i}(t);export{O as IsApiAvailableModule,k as isApiAvailable,H as validators};
